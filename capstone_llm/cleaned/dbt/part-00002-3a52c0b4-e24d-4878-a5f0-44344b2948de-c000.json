{"title":"Using multiple columns in a Unique_Key for incremental loading in DBT","question_body":"<p>For incremental models, the DBT documentation <a href=\"https://docs.getdbt.com/docs/building-a-dbt-project/building-models/configuring-incremental-models\" rel=\"noreferrer\">here</a> says:</p>\n<blockquote>\n<p>The unique_key should be supplied in your model definition as a string representing a simple column or a list of single quoted column names that can be used together, for example, ['col1', 'col2', â€¦])</p>\n</blockquote>\n<p>I've built an incremental model in DBT with this incremental definition</p>\n<pre><code>{{\n  config(\n    materialized='incremental',\n    unique_key = ['Col1', 'Col2', 'Col3']\n  )\n}}\n</code></pre>\n<p>Which compiles into this merge statement in in Snowflake:</p>\n<pre class=\"lang-sql prettyprint-override\"><code>using DW_DEV.dbt_dgarrison_DATA_STAGING.MY_TABLE__dbt_tmp as DBT_INTERNAL_SOURCE\n    on \n        DBT_INTERNAL_SOURCE.['Col1', 'Col2', 'Col3'] = DBT_INTERNAL_DEST.['Col1', 'Col2', 'Col3']\n...\n</code></pre>\n<p>And this reasonably throws a SQL ERROR complaining about the brackets:</p>\n<blockquote>\n<p>SQL compilation error: syntax error line 4 at position 32 unexpected '['. syntax error line 4 at position 45 unexpected ','. syntax error line 4 at position 98 unexpected '['. syntax error line 4 at position 111 unexpected ','.</p>\n</blockquote>\n<p>I can't find any other good examples using multiple columns this way. (there are options involving concatenating columns, and I'm open to recommendations on the best approach to that, but I'm trying to figure out how to use the DBT recommended syntax)</p>\n","answer_body":"<p>As part of <a href=\"https://github.com/dbt-labs/dbt-core/releases/tag/v1.1.0\" rel=\"noreferrer\">dbt-core 1.1.0</a>, we can now <a href=\"https://github.com/dbt-labs/dbt-core/pull/4618\" rel=\"noreferrer\">pass a list to the unique_key statement in incremental models</a>. See the original issue <a href=\"https://github.com/dbt-labs/dbt-core/issues/2479\" rel=\"noreferrer\">here</a>.</p>\n<p>This means that you should be able to achieve your goal by updating <code>dbt-core</code> and your <code>dbt-&lt;adapter&gt;</code> version locally; or updating your dbt Cloud version accordingly, to 1.1.0, since given the error you get, it looks like <code>unique_key</code> is still looking for a single string instead of an array.</p>\n"}
